function _extends(){return(_extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,n)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _iterableToArrayLimit(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,o,a=[],i=!0,s=!1;try{for(t=t.call(e);!(i=(n=t.next()).done)&&(a.push(n.value),!r||a.length!==r);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==t.return||t.return()}finally{if(s)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}define(["dpz.globalPayments.status","paymentmodules/paymenthelpers/dpz.applePayHelper","shared.components"],function(r,e,t){function n(){return Object.entries(A).reduce(function(e,r){var t=_slicedToArray(r,2),n=t[0],o=t[1];return jsDPZ.app.store.getStore().data.AcceptableCreditCards.includes(o)&&e.push(n),e},[])}function o(){l({currencyCode:"USD",countryCode:dpz.market.marketCode,merchantCapabilities:m,supportedNetworks:n(),total:{amount:[jsDPZ.app.order.getOrder().data.Details.Amounts.Customer,site.data.tipAmount].reduce(function(e,r){return e+Number(r)},0).toFixed(2).toString(),label:"Dominoâ€™s",type:"final"}});var r=window.ApplePaySession,e=function(){for(var e=0;null!=r&&r.supportsVersion(e+1);)e++;return e}();d(new r(e,c())),dpz.utag.fire.link(null,{event_name:"Check out with Apple Pay"}),$(".js-placeOrder").click()}function a(t){jsDPZ.topic("paymentForm.giftcard").subscribe(function(e){var r=e.selected;t(r)})}var i,s=e.beginPaymentFlow,c=e.getApplePayConfig,p=e.getApplePayToken,u=e.renderApplePayButton,l=e.setApplePayConfig,d=e.setApplePaySession,y=t.ApplePayOption,f="AciApplePay",m=["supports3DS"],A={amex:"American Express",discover:"Discover Card",jcb:"JCB",masterCard:"Mastercard",visa:"Visa"},P=["SUCCESS","PLACE_ORDER_FAILED","ABORTED","FAILED","REFUND_TRIGGERED","PENDING","TECHNICAL_ERROR","WAITING_CONFIRMATION","DECLINED","DUPLICATE_ORDER","CONFIGURATION_MISSING","WAITING_NOTIFICATION","AUTHORIZATION_FAILED","CANCELLED"],b={method:"POST",url:urlConfig.legacyApi+"/power/paymentGatewayService/validateWallet?providerId=ACI_APPLE_PAY&walletType=APPLE_PAY"},O={0:function(p){return $.Deferred(function(c){require(["dpz.placeorder"],function(e){var r=e.getOrderObject,t=e.success,n=r();p.Status=0,jsDPZ.util.sessionStorage("gpmTransactionNumber",p.transactionMerchant||p.id);var o=p.orderRequestDto.Order,a=o.PulseOrderGuid,i=o.metaData,s=void 0===i?{}:i;n.Order.PulseOrderGuid=a,n.Order.metaData=_objectSpread(_objectSpread({},n.Order.metaData),s),c.resolve(t($.extend({},n,{Details:{StoreOrderID:p.storeOrderID}})))})})}};return _defineProperty(i={aciApplePayString:f},"".concat(f.toLowerCase(),"Forms"),{init:function(e){if(jsDPZ.app.customer.getCustomer().data.Session.ShowAciApplePayAtCheckout){u({configExtension:{merchantCapabilities:m,supportedNetworks:n()},overrideClickHandler:o});var r=document.querySelector(".js-applePayContainer");r&&preact.render(preact.h(y,_extends({inputValue:f,subscribeToGiftCardChanges:a},e)),r)}}}),_defineProperty(i,"placeOrderAjaxSettings",{url:jsDPZ.config.power.globalPaymentGateway.processPayment(!0),data:function(){return $.Deferred(function(o){require(["dpz.placeorder"],function(e){(0,e.buildAndReturnOrderJSON)().then(function(e){var r=e.Order.Payments.find(function(e){return"AciApplePay"===e.Type}),t=p(),n=$.extend(!0,{},r,{PaymentMethod:{applePaySession:window.btoa(JSON.stringify(t.paymentData))},Token:"",Type:"AciApplePay"});e.Order.Payments=e.Order.Payments.filter(function(e){return"AciApplePay"!==e.Type}).concat(n),o.resolve({orderRequestDto:e})})})})},dataType:"json",accepts:{json:"application/vnd.com.dominos.ecommerce.payment.gateway.response+json; version=1.0"},beforeSend:function(e){var r=jsDPZ.util.sessionStorage("dpz_authorization");r&&e.setRequestHeader("Authorization","Basic ".concat(r))},context:{done:function(e){$.extend(e,{initialResponse:!0}),r.handle(e)}}}),_defineProperty(i,"onSubmit",function(){return new Promise(function(e,o){"applepay"===$(".js-paymentType:checked").data("gpm-payment-subtype")?s({link:b,onSubmitReject:function(){for(var e,r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];(e=console).log.apply(e,["In onSubmitReject:"].concat(t)),o.apply(void 0,t)},onSubmitResolve:e,placeOrderData:require(["dpz.placeorder"],function(e){return(0,e.buildAndReturnOrderJSON)().then(function(e){return $.extend(!0,{},e,{Order:{Payments:[{Amount:jsDPZ.app.order.getOrder().data.Details.Amounts.Customer,Type:"AciApplePay"}]}})})})}):e(null)})}),_defineProperty(i,"provider",f.toLowerCase()),_defineProperty(i,"statusCodes",P),_defineProperty(i,"statusHandlers",$.extend(!0,{},P.reduce(function(e,r,t){return e[t]=function(o,a){return function(){for(var e,r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];(e=console).log.apply(e,["Received status ".concat(o," (").concat(a,") with:")].concat(t)),site.func.overlayToggle(!0,"codeOverlay",{},{code:"eApplePayGenericError",label:site.format.phoneNumber({number:jsDPZ.app.store.getStore().data.Phone},"storePhone")})}}(t,r),e},{}),O)),_defineProperty(i,"supportedNetworks",n()),i});