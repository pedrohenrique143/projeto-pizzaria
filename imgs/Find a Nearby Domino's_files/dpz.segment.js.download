var _excluded=["event_name","segment_event"],_excluded2=["page_name"];function _objectWithoutProperties(e,r){if(null==e)return{};var t,n,o=_objectWithoutPropertiesLoose(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],0<=r.indexOf(t)||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function _objectWithoutPropertiesLoose(e,r){if(null==e)return{};var t,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t=a[n],0<=r.indexOf(t)||(o[t]=e[t]);return o}function _extends(){return(_extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,n)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _createForOfIteratorHelper(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){t&&(e=t);function n(){}var o=0;return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,d=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){d=!0,a=e},f:function(){try{i||null==t.return||t.return()}finally{if(d)throw a}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}define("dpz.segment",["dpz.analytics","dpz.config","dpz.customer","dpz.hybrid","segment/mappers","segment/ecommerceMiddlewares","segment/genericMiddlewares","segment/identifyMiddlewares","dpz.utag.constants"],function(i,e,r,t,n,d,c,u,o){function s(){return killConfig.isMarketEnabled("72b925fb-2e0b-4fce-be02-9063ae056e16")}var p,a=e.getMarketProperty,l=r.userStatus,f=r.getStatus,v=t.isActive,b=t.getPlatform,_=t.segmentTrackIdentify,m=t.segmentTrackReset,y=n.amountMapper,g=n.couponMapper,j=n.variantMapper,h=o.UTAG_EVENTS.MINI_CART,O=new Promise(function(e){p=e}),P=jsDPZ.util.sessionStorage("segment_checkout_id");P||(P=jsDPZ.util.uuid(),jsDPZ.util.sessionStorage("segment_checkout_id",P));function D(){var e=jsDPZ.app.order.getOrder().data.Details,r=(e=void 0===e?{}:e).Amounts,t=void 0===r?"":r,n=e.OrderID,o=void 0===n?"":n,a=e.Variants,i=(void 0===a?[]:a).map(function(e){var r=e.Code,t=e.Price,n=e.Qty;return _objectSpread(_objectSpread({},j(r)),{},{price:t,quantity:n})});s()&&dpz.utag.fire.link(null,_objectSpread(_objectSpread({},y(t)),{},{event_name:"Order Updated",order_id:o,products:i}))}function S(){var e=jsDPZ.app.order.getOrder().data.Details,r=(e=void 0===e?{}:e).Amounts,t=void 0===r?"":r,n=e.OrderID,o=void 0===n?"":n,a=e.Variants,i=(void 0===a?[]:a).map(function(e){var r=e.Code,t=e.Price,n=e.Qty;return _objectSpread(_objectSpread({},j(r)),{},{price:t,quantity:n})});s()&&dpz.utag.fire.link(null,_objectSpread(_objectSpread({},y(t)),{},{order_id:o,products:i}))}function w(e){var r=e.couponCode,t=e.reason,n=jsDPZ.app.order.getOrder().data.Details,o=(n=void 0===n?{}:n).OrderID,a=void 0===o?"":o;s()&&dpz.utag.fire.link(null,_objectSpread(_objectSpread({},g(r)),{},{event_name:"Coupon Denied",reason:t,order_id:a}))}function k(e){var i=_extends({},e);s()&&T&&O.then(function(e){var r=_objectSpread(_objectSpread({},(0,e.prepareLink)(i)),function(e){if(jsDPZ.util.empty(null==e?void 0:e.attributes))return{};var r,t={},n=_createForOfIteratorHelper(e.attributes);try{for(n.s();!(r=n.n()).done;){var o=r.value,a=o.name,i=o.value;a.startsWith("data-dpz-segment-track-")&&(t[a.replace(/^data-dpz-segment-track-(.*)/,"$1").replace(/-/g,"_")]=i)}}catch(e){n.e(e)}finally{n.f()}return t}(i.el)),t=r.event_name,n=r.segment_event,o=void 0===n?"":n,a=_objectWithoutProperties(r,_excluded);return window.analytics.track(o||t,_objectSpread({},a))})}function C(o){s()&&M&&O.then(function(e){var r=(0,e.prepareView)(o),t=r.page_name,n=_objectWithoutProperties(r,_excluded2);return s()&&A&&(t===h&&s()&&dpz.utag.fire.link(null,{event_name:"Cart Viewed"}),"Checkout Review Order"===t&&function(){var e=jsDPZ.app.order.getOrder().data.Details.Coupons;s()&&dpz.utag.fire.link(null,_objectSpread(_objectSpread({},y()),{},{checkout_id:P,event_name:"Checkout Started",order_id:jsDPZ.app.order.getOrder().data.Details.OrderID,coupon:e.map(function(e){return e.Code}).join(" - ")}))}(),"Checkout Confirmation"===t&&"false"===n.con_refresh&&function(){var e=(site.data.lastOrder||{}).Details,r=(e=void 0===e?{}:e).Amounts,t=void 0===r?"":r,n=e.OrderID,o=void 0===n?"":n,a=e.Variants,i=(void 0===a?[]:a).map(function(e){var r=e.Code,t=e.Price,n=e.Qty;return _objectSpread(_objectSpread({},j(r)),{},{price:t,quantity:n})});s()&&dpz.utag.fire.link(null,_objectSpread(_objectSpread({},y(t)),{},{checkout_id:P,event_name:"Order Completed",order_id:o,products:i,shippingMethod:jsDPZ.app.order.getOrder().data.Details.ServiceMethod}))}()),window.analytics.page(t,_objectSpread(_objectSpread({},n),{},{page_name:t,name:t,title:t,path:location.pathname+location.hash}))})}function E(e){var r=0<arguments.length&&void 0!==e?e:{},t=r.CustomerID,n=r.Email,o=r.FirstName,a=r.LastName,i=r.Phone,d=r.Type,c=r.CreateTime,u=r.isLogin,s=void 0!==u&&u,p=r.isNew,l=void 0!==p&&p;if(z){var f=v?b().toLowerCase():"web",m=_objectSpread({createdAt:c,user_id:n,email:n,firstName:o,lastName:a,phone:i,type:d},l&&{signup_source:f});window.analytics.identify(t,m),v&&"function"==typeof _&&_(_objectSpread({user:t},m))}Z&&l&&k({event_name:"Signed Up",username:t,type:d,first_name:o,last_name:a,email:n,phone:i}),Z&&s&&k({event_name:"Signed In",username:t}),(s||l)&&jsDPZ.topic("site.onPage").publish({analyticsTitle:"Authenticated"})}var I=a("thirdParty").segment.modules,Z=I.isB2BSaaSEnabled,A=I.isECommerceEnabled,z=I.isIdentifyEnabled,M=I.isPageEnabled,T=I.isTrackEnabled;return{checkoutId:P,init:function(e){var o=e.links,a=e.views,n=e.updateData;s()&&require(["external/segment"],function(){if(p(i(n)),c.forEach(function(e){return window.analytics.addSourceMiddleware(e)}),z&&u.forEach(function(e){return window.analytics.addSourceMiddleware(e)}),A&&(d.forEach(function(e){return window.analytics.addSourceMiddleware(e)}),$(document).on("/order/variant/new/",function(e,r){var t=r.couponCode,n=r.variantCode,o=r.quantity;dpz.utag.fire.link(null,{event_name:"Product Added",cart_id:jsDPZ.app.order.getOrder().data.Details.OrderID,variantCode:n,quantity:o,coupon:t})}),$(document).on("/order/variant/delete/",function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=r.variantCode,n=r.quantity,o=r.price;t&&dpz.utag.fire.link(null,{event_name:"Product Removed",cart_id:jsDPZ.app.order.getOrder().data.Details.OrderID,variantCode:t,quantity:n,price:o})}),$(document).on(["/order/price/","/order/coupon/add/","/order/coupon/delete/","/order/variant/new/","/order/variant/edit/","/order/variant/delete/"].join(" "),D),$(document).on("/order/coupon/add/",function(e,r){jsDPZ.util.empty(r)||function(e){var r=e.couponCode,t=jsDPZ.app.order.getOrder().data.Details,n=(t=void 0===t?{}:t).OrderID,o=void 0===n?"":n;s()&&dpz.utag.fire.link(null,_objectSpread(_objectSpread({},g(r)),{},{event_name:"Coupon Applied",order_id:o}))}(r)}),$(document).on("/order/coupon/delete/",function(e,r){jsDPZ.util.empty(r)||function(e){var r=e.couponCode,t=jsDPZ.app.order.getOrder().data.Details,n=(t=void 0===t?{}:t).OrderID,o=void 0===n?"":n;s()&&dpz.utag.fire.link(null,_objectSpread(_objectSpread({},g(r)),{},{event_name:"Coupon Removed",order_id:o}))}(r)}),jsDPZ.topic("order.payment.refund").subscribe(S),jsDPZ.topic("order.coupon.rejected").subscribe(w)),Z||z){var e=jsDPZ.app.customer.getCustomer().data.CustomerID,r=f(),t=site.storage.load("segment_customer_id");e?(E(jsDPZ.app.customer.getCustomer().data),a.forEach(C),o.forEach(k)):r===l.REMEMBERED&&site.storage.load("CID")?jsDPZ.ajax.customerLogin({data:{rememberMe:!0,loyaltyIsActive:dpz.loyalty.loyaltyIsOk()},success:function(e){jsDPZ.app.customer.setCustomerFromPower(e),E(jsDPZ.app.customer.getCustomer().data),a.forEach(C),o.forEach(k)},error:function(t,e,n){require(["dpz.profile"],function(e){var r=e.handleRememberedUserLoginError;a.forEach(C),o.forEach(k),r({error:n,xhr:t})})}}):(r===l.ANONYMOUS&&t&&(site.storage.remove("segment_customer_id"),function(e){var r=e.customerId;z&&(window.analytics.reset(),v&&"function"==typeof m&&m()),Z&&k({event_name:"Signed Out",username:r})}({customerId:t})),a.forEach(C),o.forEach(k)),jsDPZ.topic("customerLogin.success").subscribe(function(e){return E(_objectSpread(_objectSpread({},e),{},{isLogin:!e.isNew}))})}})},link:k,view:C}});