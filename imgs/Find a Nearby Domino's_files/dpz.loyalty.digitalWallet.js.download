function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,a)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}define(["dpz.config","dpz.loyalty.digitalWallet.methods","dpz.launchDarkly!external/ldclient.min","dpz.abTesting","abtests/DPZ_ECOM-67857"],function(e,t,l,r,a){function c(e){return function(e){var t=l.client.getUser();return t.custom.customerId=e,l.client.identify(t)}(e).then(function(){return site.func.getOffers("DPZ_ECOM-67857")}).then(i).then(n)}var s=e.getMarketProperty,u=t.getFormattedDigitalWallet,i=r.setTest,n=a.getEligibleExperiences,d="digitalwallet",f=function(){var e,t,r,a=((null===(e=jsDPZ.app.customer.getCustomer().data.LoyaltyPrograms)||void 0===e?void 0:null===(t=e.digitalwallet)||void 0===t?void 0:null===(r=t.offersToDisplay)||void 0===r?void 0:r.currentOffers)||[]).filter(function(e){return"Available"===e.status}),i=jsDPZ.app.order.getOrder().data.Details.Coupons;return a.filter(function(t){return!i.some(function(e){return e.Code===t.code})}).length};return{digitalWalletTest:c,getAvailableOffersCount:f,updateDealsBadge:function(){if($(".js-dealsBadge").length){var e=f();$(".js-dealsBadge").text(e)}},setDigitalWallet:function(){return new Promise(function(i){var n=jsDPZ.app.customer.getCustomer().data,o=n.CustomerID;(function(a){var i={digitalWalletVisible:!1,digitalWalletGroupValue:null};return new Promise(function(t){var e;(null===(e=s("loyalty").digitalWallet)||void 0===e?void 0:e.enabled)||t(i);var r=l.client.getUser();r.custom.customerId=a,l.client.identify(r).then(function(){l.client.variation("6ac50cd5-16cd-4ee6-a205-5df00ef31d21")||t(i);var e=l.client.variation("268f49b0-b33b-4a96-9d55-de686d16e67c");i.digitalWalletGroupValue=e,r.custom.digitalWalletGroup=e,r.custom.sourceOrganizationUri="order.dominos.com",site.sessionTools.save().then(function(){l.client.identify(r).then(function(){l.client.variation("83ee9e72-6f39-493d-b383-aa9bf03d6ac7")?c(a).then(function(){i.digitalWalletVisible=!0,t(i)}):t(i)}).catch(function(){t(i)})})}).catch(function(){return t(i)})})})(o).then(function(e){var t=e.digitalWalletVisible,r=e.digitalWalletGroupValue;if(t){var a={customerAttributes:{ecommCustomerId:o}};jsDPZ.ajax.loyaltyProgramOffer({programName:d,payload:a}).then(function(e){n.LoyaltyPrograms=_objectSpread(_objectSpread({},n.LoyaltyPrograms),{},{digitalwallet:_objectSpread(_objectSpread({},u(e)),{},{digitalWalletGroup:r,digitalWalletVisible:!0})}),dpz.utag.fire.link(null,{abtest_bucket_5:"Wallet offers: ".concat(f())}),site.sessionTools.save(),i()}).catch(i)}else n.LoyaltyPrograms=_objectSpread(_objectSpread({},n.LoyaltyPrograms),{},{digitalwallet:{digitalWalletGroup:r}}),i()}).catch(i)})},isDigitalWalletActive:function(){return new Promise(function(e){var t=jsDPZ.app.customer.getCustomer();e("LoyaltyPrograms"in t.data&&d in t.data.LoyaltyPrograms&&"offersToDisplay"in t.data.LoyaltyPrograms.digitalwallet)})}}});