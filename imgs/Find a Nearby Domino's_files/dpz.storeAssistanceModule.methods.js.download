function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=new Array(r);t<r;t++)o[t]=e[t];return o}function _iterableToArrayLimit(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var o,i,n=[],s=!0,a=!1;try{for(t=t.call(e);!(s=(o=t.next()).done)&&(n.push(o.value),!r||n.length!==r);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==t.return||t.return()}finally{if(a)throw i}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}define("dpz.storeAssistanceModule.methods",["abtests/DPZ_ECOM-69775","dpz.storeAssistanceModule.constants","dpz.storeAssistanceModule.props","dpz.storeAssistanceModule.state","dpz.storeAssistanceModule.renderer","dpz.storeAssistanceModule.handlers","dpz.customer","dpz.config","dpz.goloDuc","simplr","site.funcs"],function(e,r,t,o,i,n,s,a,l,d,u){function c(e){switch(e){case"D":case"H":return L;case"C":case"P":case"T":case"I":return N;case"X":return b;default:return null}}function p(){return jsDPZ.app.customer.getCustomer()}function j(){return p().getSessionData()}function T(){return jsDPZ.app.store.getStore()}function A(e){return jsDPZ.ajax.storeProfile({StoreID:e}).then(function(e){return e.Address||jsDPZ.app.store.setStoreFromPower(e),e})}function E(e){var r=e.AllowDuc,t=e.StoreID;return!y()&&T().data.AllowDuc&&T().getAvailableServiceMethods().includes("DriveUpCarryout")||w({AllowDuc:r})||P(t)}function v(e){return _slicedToArray(e,1)[0]}function D(e){var r=0<arguments.length&&void 0!==e?e:{},o=r.Address,i=r.StoreID,n=r.ServiceMethod,t=r.isDucOrder,s=void 0!==t&&t,a=m("locations").ignoredAddressFields,l=Object.values(a).reduce(function(e,r){return _objectSpread(_objectSpread({},e),{},_defineProperty({},r,""))},{}),d=j();d.Address=_objectSpread(_objectSpread({},o),l),d.AddressSelection=o.Name||"__OTHER_ADDRESS__",d.ServiceMethod=n,d.StoreID=i,site.storage.save("ServiceType",n),site.sessionTools.save().then(function(){var e=site.func.buildURL({url:"#!/customer/store/update",parameters:{ServiceMethod:n,StoreID:i,Substituted:"false"}});_(e);var r=n===N,t=Boolean(o.Street);r&&t&&W({serviceMethod:n,storeCity:o.City,StoreId:i,storePostalCode:o.PostalCode,storeRegion:o.Region,storeStreet:o.Street,isDucOrder:s}),Z()})}function R(e){var r=e.StoreID,t=e.ServiceMethod,S=void 0===t?N:t;return A(r).then(function(e){var r=e.Address,t=r.City,o=r.PostalCode,i=r.Region,n=r.Street,s=e.AllowCarryoutOrders,a=e.AllowDeliveryOrders,l=e.AllowDineInOrders,d=e.AllowDuc,u=e.AllowHotspotLiteOrders,c=e.AllowPickupWindowOrders,p=e.IsOnlineNow,A=e.StoreID,v=S===b&&E({AllowDuc:d,StoreID:A}),f=F();f&&(j().CurbsidePickup=v),v&&!f&&(jsDPZ.app.order.getOrder().data=_objectSpread(_objectSpread(_objectSpread({},jsDPZ.app.order.getOrder().data),h),{},{isDucOrder:!0})),site.sessionTools.save(),W({isCarryoutAvailable:s,isDeliveryAvailable:a,isDineInAvailable:V&&l,isDucAvailable:E({AllowDuc:d,StoreID:A}),isHotspotAvailable:u,isOnline:p,isPickupWindowAvailable:c,isDucOrder:v});var y=H();return D({Address:{City:t,PostalCode:o,Region:i,Street:y?n:null},ServiceMethod:N,isDucOrder:v,StoreID:A})})}function k(){return p().fetchOrderHistory().then(function(e){var r=g(e);if(r.length){var l=C(r);A(l.StoreID).then(function(e){var r=e.AllowCarryoutOrders,t=e.AllowDeliveryOrders,o=e.AllowDineInOrders,i=e.AllowDuc,n=e.AllowHotspotLiteOrders,s=e.AllowPickupWindowOrders,a=e.IsOnlineNow;return W({customerCity:l.Address.City,customerPostalCode:l.Address.PostalCode,customerRegion:l.Address.Region,customerStreet:l.Address.Street,isCarryoutAvailable:r,isDeliveryAvailable:t,isDineInAvailable:V&&o,isDucAvailable:E({AllowDuc:i,StoreID:l.StoreID}),isHotspotAvailable:n,isOnline:a,isPickupWindowAvailable:s,serviceMethod:L,StoreId:l.StoreID}),D(l)})}})}var H=e.getHasNationalStoreSelected,N=r.CARRYOUT,L=r.DELIVERY,b=r.DCD,f=r.INACTIVE,y=t.isFutureOrder,S=t.hasServiceMethodSelected,O=t.setIsAutoSet,h=t.sessionOptions,W=o.setState,Z=i.renderSam,z=n.getServiceMethodFromOrder,I=s.isProfiled,m=a.getMarketProperty,F=l.getIsGoloDucOrderingEnabled,w=l.showLocatorAndOrderSettingsIndicator,_=d.controller.mRouteAndExecute,P=u.func.displayCurbside,V=killConfig.isMarketEnabled("dineIn"),x=killConfig.isMarketEnabled("hotspots"),g=function(e){return e.customerOrders.filter(function(e){return"Delivery"===e.order.ServiceMethod})},C=function(e){var r=function(e){return e.reduce(function(e,r){var t=r.order.Address,o=t.Street,i=t.StreetName,n=o||i||"",s=e[n]||0;return _objectSpread(_objectSpread({},e),{},_defineProperty({},n,s+1))},{})}(e),t=Object.entries(r),o=_slicedToArray(t,1)[0],i=function(r){return function(e){return e.order.Address.Street===r}}(_slicedToArray(t.reduce(function(e,r){var t=_slicedToArray(r,2),o=t[0],i=t[1],n=e[o];return i<n?e:n===i?[].concat(_toConsumableArray(e),[r]):n<i?[r]:e},[o]).map(v),1)[0]),n=e.find(i).order;return{Address:n.Address,ServiceMethod:n.ServiceMethod,StoreID:n.StoreID}};window.mostPopularAddress=C;function U(){B(p().data.Email)}function M(){return p().fetchOrderHistory().then(function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).customerOrders,r=C(void 0===e?[]:e)||{},t=r.ServiceMethod,o=r.StoreID;return{DOMINANT_SERVICE_METHOD:(void 0===t?"":t)||"",DOMINANT_STORE:{value:void 0===o?"":o}}})}function K(e){return I()?jsDPZ.ajax.fetchCustomerDetails(e):$.Deferred().resolve({})}var B=function(e){(m("profile").useCustomerDetailService?K:M)({key:e,type:"email"}).then(function(e){var r=e.DOMINANT_SERVICE_METHOD,t=e.DOMINANT_STORE,o="string"==typeof r?r:c(null==r?void 0:r.value),i=H();if(!S()||i)return O(!0),Boolean(o)&&o||(i||W({serviceMethod:f}),Z()),o===L?k():[N,b].includes(o)&&null!=t&&t.value?R({StoreID:t.value,ServiceMethod:o}):void 0}).catch(function(){W({serviceMethod:f}),jsDPZ.topic("storeAssistanceModule.updated").publish()})};return{getCurrentOrderInfo:function(){var e=jsDPZ.app.order.getOrder().data,r=e.Customer.Address,t=r.City,o=r.PostalCode,i=r.Region,n=r.Street,s=e.Details,a=s.ServiceMethod,l=s.StoreID,d=e.isDucOrder,u=e.isPickupOrder,c=e.lastSelectedStoreLocatorServiceMethodInputValue,p=j().CurbsidePickup,A=T().data,v=A.Address,f=v.City,y=v.Region,S=v.Street,D=v.PostalCode,b=A.AllowCarryoutOrders,O=A.AllowDeliveryOrders,h=A.AllowDineInOrders,I=A.AllowDuc,m=A.AllowHotspotLiteOrders,w=A.AllowPickupWindowOrders,_=A.IsOnlineNow,P=A.StoreID,g=z({isDucOrder:F()?p:d,isPickupOrder:u,serviceMethodDetail:a}),C=H(),M="Hotspots"===c&&a===L;W({isCarryoutAvailable:b,isDeliveryAvailable:O,isDineInAvailable:V&&h,isDucAvailable:E({AllowDuc:I,StoreID:P}),isDucOrder:F()?p:d,isHotSpot:M,isHotspotAvailable:m,isHotspotsEnabled:x,isOnline:_,isPickupOrder:u,isPickupWindowAvailable:w,serviceMethod:g,storeCity:f,storeID:l,storePostalCode:D,storeRegion:y,storeStreet:S}),n&&W({customerCity:t,customerPostalCode:o,customerRegion:i,customerStreet:n}),!g||C?U():g!==N||S?g!==L||n||(k(),Z()):(R({StoreID:l,ServiceMethod:g,isDucOrder:d}),Z())},setOrderAddress:D,serviceMethodFromAbbreviation:c,setServiceMethodFromProfileData:B}});