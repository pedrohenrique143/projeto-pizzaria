function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}define("dpz.deliverToMe",["dpz.config","dpz.easyOrder","dpz.geolocation","dpz.kiosk","marketconfig/dpz.lang.errors"],function(e,t,r,o,n){if(!(0,e.isMarketEnabled)("1cad9dd6-4699-403d-9813-9f9b2e98bce3")||o.isActive)return{isActive:function(){return!1},getDeliverToMe:function(){return $.when(!1)},getStores:function(){return $.when({dtmHotspotsEnabled:!1,hotspotsDTMResponse:{},validDTMHotspots:[]})},watchUserLocation:function(){return!1},isDeliverToMeOrder:function(){return!1}};var i={radius:.16,deliverToMeDeliveryInstructionsLength:70,errorData:{code:"eNoDeliveryStoreFound",label:[]},getStores:function(){var t=killConfig.isMarketEnabled("1cad9dd6-4699-403d-9813-9f9b2e98bce3"),e=i.isActive()&&i.watchUserLocation().cached.coords;return t&&e?i.getDeliverToMe(e,e).then(function(e){return i.cacheDTMStoreResponse(e),{dtmHotspotsEnabled:t,hotspotsDTMResponse:e,validDTMHotspots:i.validateHotspots(null==e?void 0:e.DeliverToMeSpots)}}).catch(function(){return null}):null},cacheDTMStoreResponse:function(e){return jsDPZ.app.customer.getCustomer().data.Session.DTMCachedResponse=e,site.sessionTools.save()},validateHotspots:function(e){return null!=e&&e.length?e.map(function(e){return _objectSpread(_objectSpread({},e),{},{validDeliveryStores:i.validateStoreList(e.StoreList)})}):[]},getValidDeliveryStores:function(e){return e.validDeliveryStores},hasValidDeliveryStores:function(e){return Boolean(e.validDeliveryStores.length)},validateStoreList:function(e){if(!e.length)return[];var t=e.map(function(e){return e.StoreInformation}),r=site.func.uniqBy(t,"StoreID");return r.filter(function(e){return e.IsDeliveryStore}).length?r.map(function(e){if(!e.IsDeliveryStore)return null;if("ManualOffline"===e.OnlineStatusCode&&dpz.template.translateError("eManualOffline"))return i.errorData.code="eManualOffline",null;if(e.IsOnlineNow){var t=site.func.allowFutureOrders(e.NoDeliveryOrdersUntil);return e.AllowDeliveryOrders||t?e:(i.errorData.code="eDeliveryDisabled",null)}return i.errorData.code="eStoreIsClosed",null}).filter(function(e){return Boolean(e)}):(i.errorData.code=dpz.template.isTranslationStringEmpty("errors.eCEPNotFound",n)?"eNoDeliveryStoreFound":"eCEPNotFound",[])},clearDeliverToMe:function(){delete jsDPZ.app.order.getOrder().data.DeliverySpot,jsDPZ.app.order.getOrder().data.Customer.Address.Coordinates={Latitude:0,Longitude:0},jsDPZ.app.order.getOrder().data.Customer.Address.Name="",jsDPZ.app.order.getOrder().data.Customer.Address.Description="",site.sessionTools.save()},setLocatorPermission:function(e){dpz.util.cookies.setItem("geolocationPermission",e)},getLocatorPermission:function(){var e=dpz.util.cookies.getItem("geolocationPermission");return"false"!==e&&e},getDeliverToMe:function(e,t,r,o){var n=$.extend({distanceCoordinates:t},e);return r&&(n.radius=r),o&&(n.maxResults=o),jsDPZ.ajax.getDeliverToMeByGPSCoords(n).then(function(e){return e})},watchUserLocation:function(e){var t=r.watchUserLocation(e);return $.when(t.cached).fail(function(e){jsDPZ.topic("deliverToMe.geolocation.error").publish({error:new Error("Unable to get the cached user location"),customData:e})}),t.cached!==t.current&&t.current.fail(function(e){jsDPZ.topic("deliverToMe.geolocation.error").publish({error:new Error("Unable to get the current user location"),customData:e})}),t},isActive:function(){return!t.isInEasyOrderFlow()&&!o.isActive},addressInDeliverToMeArea:function(e){return function(e,t){return t.timeout=5e3,jsDPZ.ajax.getDeliverToMeByAddress($.extend(!0,{address:e},t)).then(function(e){return!!e.DeliverToMe&&!!e.DeliverToMe.length})}(e,{radius:i.radius,maxResults:1})},isDeliverToMeOrder:function(e){var t=(0<arguments.length&&void 0!==e?e:jsDPZ.app.order.getOrder().data).DeliverySpot;return i.isActive()&&Boolean(null==t?void 0:t.PlaceId)},autoLocateDeliverToMeStore:function(d){var e=d.validDeliveryStores[0];jsDPZ.ajax.storeProfile(e).then(function(e){var t=jsDPZ.app.customer.getCustomer().getSessionData(),r=d.Address,o=r.City,n=r.State,i=r.ZipCode,s={Coordinates:{Latitude:d.Latitude,Longitude:d.Longitude},City:o,Region:n,PostalCode:i},a={Name:"Hotspot",Description:"",Id:d.PlaceId};e.Address={City:e.City,PostalCode:e.PostalCode,Region:e.Region,Street:e.Street,StreetName:e.StreetName,UnitNumber:e.UnitNumber,UnitType:e.UnitType},t.Address=_objectSpread(_objectSpread({},s),{},{Name:d.DisplayName,Description:d.DisplayName}),t.StoreID=e.StoreID,delete jsDPZ.app.order.getOrder().data.Customer.Address,jsDPZ.app.order.getOrder().data.Customer.Address=_objectSpread({},s),jsDPZ.app.store.setStore(e),$.extend(!0,jsDPZ.app.order.getOrder().data,{Address:s},{DeliveryHotspot:a},{DeliverySpot:d},{Notifications:{}}),site.sessionTools.save().then(window.location="".concat(urlConfig.root,"/pages/order/#!/locate/?StoreID=").concat(e.StoreID,"&type=Delivery&latitude=").concat(d.Latitude,"&longitude=").concat(d.Longitude,"&deliverToMe=true"))}).fail(function(){site.func.powerCommunicationError()})},isSettingNewLocation:!1,getIsSettingNewLocation:function(){return i.isSettingNewLocation},setIsSettingNewLocation:function(e){i.isSettingNewLocation=e}};return i});