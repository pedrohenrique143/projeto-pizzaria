function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var o,s,a=[],n=!0,i=!1;try{for(r=r.call(e);!(n=(o=r.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==r.return||r.return()}finally{if(i)throw s}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}define(["dpz.template","dpz.dom","dpz.googleMapsLocator","dpz.customer","dpz.profile","dpz.config","site.funcs","marketjs/modules/locator.region","marketjs/modules/locator.city","marketjs/modules/locator.streets","simplr","marketconfig/dpz.lang.locations"],function(e,u,t,r,o,s,a,p,m,v,y,n){var f,i,g=r.getStatus,h=r.userStatus,S=o.isProfileValid,j=s.getMarketProperty,l=a.func,C=l.animateScroll,c=l.customerLoggedIn,P=l.isHandheld,b=l.updateMainNavigation,N=l.overlayToggle,D=l.showLoginPopup,A=l.buildURL,T=t,d=t.deliveryHandler,k=u.$inputs,_=~$.inArray(window.location.hash,["#!/customer/profile/","#!/customer/profile/new","#!/customer/settings/"]),w="BR",O=T.syncConfig({center:{lat:-13.5415477,lng:-56.3346976},carryout:{selectors:{hidden:[".js-getLocation",".js-loginContainer",".js-search-cta",".js-savedEntry",".main-gsl-container",".js-nearestStoreLabel",".js-locatorChangeLoginState",".js-GSLProfileHeader"]},zoom:{default:4}},delivery:{selectors:{visible:[".js-loginContainer",".js-search-cta",".js-savedEntry",".main-gsl-container",".js-nearestStoreLabel",".js-locatorChangeLoginState"]}},addressTypeLabels:{House:{StreetNumber:e.translate("locations.house_number",null,n)},Apartment:{StreetNumber:e.translate("locations.street_number",null,n),Unit_Number:e.translate("locations.block",null,n)},Place:{StreetNumber:e.translate("locations.bulding",null,n),Unit_Number:e.translate("locations.room_number",null,n)}}}),L=!1,Z={},I={},B=O.delivery.selectors;function E(){O.carryout.selectors.add({type:"hidden",selectors:[".js-hideCity"]}),B.add({type:"visible",selectors:[".js-hideCity"]}),B.remove({type:"visible",selectors:[".js-centerPin",".js-handheldPin"]}),jsDPZ.app.customer.getCustomer().data.Session.BoloStore&&"anonymous"===g()?B.add({type:"visible",selectors:[".js-GSLProfileHeader"]}):jsDPZ.app.customer.getCustomer().data.Session.BoloStore||B.remove({type:"visible",selectors:[".js-GSLProfileHeader"]}),"anonymous"!==g()?(B.add({type:"hidden",selectors:[".js-loginButton"]}),B.add({type:"visible",selectors:[".js-logoutButton"]}),B.remove({type:"visible",selectors:[".js-GSLProfileHeader"]})):B.remove({type:"hidden",selectors:[".js-loginButton"]}),$(".js-GSLProfileHeader").is(":visible")&&"loggedin"===g()&&$(".js-GSLProfileHeader").toggleClass("hidden")}return E(),$.extend(!0,T,{setAddress:function(e){Z=e},createProfileAddressRules:function(e){var t=e.savedAddress||{},r=!(!jsDPZ.util.empty(t)&&!jsDPZ.util.empty(t.Name))||t.Name,o=e.locationForm.settings,s=T.defaultRules(e),a={};return a=$.extend(!0,a,s,{Cep:{required:!0},City:{required:!0},StreetField1:{required:!0},Region:{required:!0},StreetName:{required:!0},StreetNumber:{required:!0},Delivery_Instructions:{showOptional:!0},Is_Default:{showOptional:!0},Address_Name:{showOptional:!0,uniqueAddress:r},UnitNumber:{required:function(){return-1!==$.inArray(o.addressType,["Apartment","Place"])}},Location_Name:{required:function(){return-1!==$.inArray(o.addressType,["Place"])}}}),L=e.isEditingAddress,a},createStoreLocatorRules:function(e){var t=e.locationForm.settings,r=T.defaultRules(e),o={};return o=$.extend(!0,o,r,{Service_Type:{required:!0},Address_Name:{showOptional:function(){return c()&&"Delivery"===t.serviceType}},Save_Address:{showOptional:function(){return c()&&"Delivery"===t.serviceType}},Is_Default:{showOptional:function(){return c()&&"Delivery"===t.serviceType}}})},defaultRules:function(e){var t=e.locationForm.settings,r=killConfig.isMarketEnabled("customerLegacyName");return{Address_Type_Select:{required:!0},City:{required:function(){return"Delivery"===t.serviceType||t.saveToProfile}},StreetField1:{required:function(){return"Delivery"===t.serviceType||t.saveToProfile}},StreetName:{required:function(){return"Delivery"===t.serviceType||t.saveToProfile}},StreetNumber:{required:function(){return"Delivery"===t.serviceType||t.saveToProfile}},Cep:{required:function(){return"Delivery"===t.serviceType||t.saveToProfile}},Region:{required:function(){return"Delivery"===t.serviceType||t.saveToProfile}},Delivery_Instructions:{showOptional:function(){return"Delivery"===t.serviceType||t.saveToProfile}},UnitNumber:{required:function(){return("Delivery"===t.serviceType||t.saveToProfile)&&-1!==$.inArray(t.addressType,["Apartment","Place"])}},Location_Name:{required:function(){return("Delivery"===t.serviceType||t.saveToProfile)&&-1!==$.inArray(t.addressType,["Place"])}},First_Name:_objectSpread({required:function(){return r&&T.isProfileBolo(e)}},r&&{requiredCompleteField:function(){return $(".js-profileFirstName").val()}}),Last_Name:{required:function(){return T.isProfileBolo(e)},requiredCompleteField:function(){return $(".js-profileLastName").val()}},Email:{required:function(){return T.isProfileBolo(e)}},Phone:{required:function(){return T.isProfileBolo(e)},phone:!0},Extension:{showOptional:function(){return T.isProfileBolo(e)}},Confirm_Email:{required:function(){return T.isProfileBolo(e)},equalToCI:function(){return $(".js-email").val()}},Create_Password:{required:function(){return T.isProfileBolo(e)}},Confirm_Password:{required:function(){return T.isProfileBolo(e)},equalToCI:function(){return $(".js-password").val()}},Save_Address:{showOptional:function(){return c()&&"Delivery"===t.serviceType}}}},isBoloStore:function(){return jsDPZ.app.customer.getCustomer().data.Session.BoloStore},boloDeliverySelector:function(){E()},isProfileBolo:function(e){var t=e.locationForm.settings;return("Delivery"===t.serviceType||t.saveToProfile)&&T.isBoloStore()&&"anonymous"===g()},bindEvents:function(r){var e=jsDPZ.app.customer.getCustomer().data.Session.Address,t=0<window.location.href.indexOf("?locations=1")||0<window.location.href.indexOf("&locations=1");u.set$inputs(r),u.set$labels(r);var o,s=k("cep"),a=k("city"),n=k("region"),i=k("streetName"),l=k("streetNumber"),c=j("mask");($(".js-phone",r).mask(c.phone.mask,c.phone.properties),$(".js-postalCode",r).mask(c.zip.mask,c.zip.properties),s.mask(c.CEP.mask,c.CEP.properties),l.mask(c.streetNumber.mask,c.streetNumber.properties),jsDPZ.app.customer.getCustomer().data.Session.Coupon=dpz.util.getQueryParameters("couponCode_0"),site.sessionTools.save(),_&&($(".js-orContainer").toggleClass("is-hidden"),$(".js-logoutButton").toggleClass("is-hidden")),jsDPZ.app.customer.getCustomer().data.Session.BoloStore&&"anonymous"===g()?$(".js-GSLProfileHeader").toggle():"loggedin"===g()&&(b(_?{main:"profile",sub:"overview"}:{main:"locations",sub:""}),$(".js-loginButton").toggleClass("is-hidden"),$(".js-logoutButton").toggleClass("is-hidden")),$.isEmptyObject(Z))?""!==e.PostalCode.trim()&&(s.val(e.PostalCode),i.val(e.StreetName),l.val(e.StreetNumber),T.fillAddress({cep:e.PostalCode,resetStreetName:!1,selector:r})):Z.PostalCode&&""!==Z.PostalCode.trim()&&(s.val((null===(o=s.masked)||void 0===o?void 0:o.call(s,Z.PostalCode||""))||Z.PostalCode),i.val(Z.StreetName),l.val(Z.StreetNumber),Z.PostalCode.trim()&&T.fillAddress({cep:Z.PostalCode,resetStreetName:!1,selector:r}));p.init({savedValue:Z.Region,dropdown:n}),m.init({savedValue:Z.City,dropdown:a}),v.init({savedValue:Z.StreetName,input:i}),n.off("change").on("change",function(){i.val(""),m.fetch({countryCode:w,state:n.val()})}),a.off("change").on("change",function(){""!==a.val()?(v.enable({input:i}),i.val(Z.StreetName)):v.off({input:i})}),i.off("keyup").on("keyup",function(e){v.fetch({cep:s.val(),countryCode:w,state:n.val(),city:a.val(),street:e.currentTarget.value.toUpperCase(),streetLimit:5})}),i.off("blur").on("blur",function(e){var t;null!==(t=e.relatedTarget)&&void 0!==t&&t.classList.contains("js-predictionsContainer")||$(".js-predictionsContainer",r).html("")}),$(".js-predictionsContainer").off("click",T.searchCEP).on("click",T.searchCEP),T.mapsBindEvents(r),killConfig.isMarketEnabled("googleMapsDelivery")&&killConfig.isMarketEnabled("googleMapsCarryout")&&T.initMap(O.selector,O.city,O.delivery),$("#locationsSearchPage, #js-customerPage").on("click",".js-delivery",T.deliveryHandler).on("click",".js-carryout ",T.carryoutHandler).on("click",".js-showOtherAddress",function(){_?T.deliveryHandler():t?T.carryoutHandler():"Carryout"===$(".circ-icons [type='radio']:checked").val()?T.carryoutHandler():T.deliveryHandler()}),t?T.carryoutHandler():_&&$(".js-mapCanvas").is(":visible")&&T.deliveryHandler();function d(e){8===e.length?T.fillAddress({cep:e,resetStreetName:!0,selector:r}):N(!0,"codeOverlay",{},{code:"eCEP"})}$(".js-searchCEP",r).off("click").on("click",function(){d(s.val().replace("-",""))}),s.off("keydown").on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),d(e.currentTarget.value.replace("-","")))}),$(".js-loginGSL").on("click",function(){D()}),$(".js-logoutButton",r).off("click").on("click",function(){y.controller.mRouteAndExecute(A({url:"#!/customer/logout/"}))}),$(".js-noCep",r).off("click").on("click",function(){p.fetch({countryCode:w}),$(".js-noCep").addClass("is-hidden"),$(".js-knowMyCep").removeClass("is-hidden",!1),s.prop("disabled",!0).val(""),a.prop("disabled",!0).val(""),i.prop("disabled",!0).val("")}),$(".js-knowMyCep",r).off("click").on("click",function(){$(".js-knowMyCep",r).addClass("is-hidden"),$(".js-noCep",r).removeClass("is-hidden"),s.prop("disabled",!1).val(""),n.prop("disabled",!0).val(""),a.prop("disabled",!0).val(""),i.prop("disabled",!0).val("")}),$(".js-addressSelection, .js-showOtherAddress, .js-locationsSearchPageForm").on("click",function(){"remembered"===g()&&D()}),jsDPZ.topic("boloStore.clickHandler").subscribe(function(t){var r;"anonymous"===g()?D():T.getCategoryProduct().then(function(e){r=e}).then(function(e){jsDPZ.ajax.customerLoginPowerCallEncrypted({authorization:jsDPZ.util.oauth.getTokens().accessTokens,customerID:jsDPZ.app.customer.getCustomer().data.CustomerID,data:{Addresses:[]}}).then(function(e){$.post({url:"https://api.dominos.com.br/golo/redirectFromGolo",data:{StoreID:t.storeID,Category:r||"",ServiceMethod:"Carryout"===$(".circ-icons [type='radio']:checked").val()?"Carryout":"Delivery"},headers:{Authorization:"Bearer ".concat(e)}}).then(function(e){window.location=e.url}).fail(function(){N(!0,"codeOverlay",{},{code:"eAPIRedirectBOLO"})})})})})},getCategoryProduct:function(){var r=dpz.history.getStates().find(function(e){return e.hash&&e.hash.includes("#!/product")});if(jsDPZ.app.customer.getCustomer().data.Session.Coupon)return $.when("Coupon");var e=r?jsDPZ.ajax.menu({StoreID:19714,includeAssets:killConfig.isMarketEnabled("wamImages")}).then(function(e){var t;return jsDPZ.app.catalog.setCatalog(e),(t=jsDPZ.app.catalog.getCatalog().data.Products[r.hash.replace(/product|builder|#|\/]|\//g,"")])&&t.ProductType?t.ProductType:"Pizza"}).fail(function(e){return"Pizza"}):"";return $.when(e)},deliveryHandler:function(){killConfig.isMarketEnabled("157458fd-44c0-44ec-b375-1a29a991985f")||(d(),T.boloDeliverySelector())},searchCEP:function(){var e={cep:k("cep").val(),city:k("city").val(),countryCode:w,state:k("region").val(),street:k("streetName").val().toUpperCase(),streetLimit:5};return jsDPZ.ajax.globalStoreSearchTypeAheadAddress(e).then(function(e){var t=e.Addresses,r=_slicedToArray(t=void 0===t?[]:t,1)[0],o=(r=void 0===r?{}:r).Cep,s=r.Neighborhood,a=void 0===s?"":s;if(o){var n=k("cep");n.val(n.masked(o)),f=jsDPZ.util.htmlUnEncode(a)}})},fillAddress:function(e){var t=e.cep,r=void 0===t?"":t,u=e.resetStreetName,p=e.selector;k("streetName").prop("disabled",!0).val(""),jsDPZ.ajax.globalStoreSearchTypeAheadAddress({cep:r,streetLimit:2}).then(function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).Addresses,t=void 0===e?[]:e,r=_slicedToArray(jsDPZ.util.htmlUnEncode(t),1)[0],o=r.Cep,s=r.City,a=r.Street,n=r.Neighborhood,i=r.State;if(t.length){f=n,k("region").append($("<option>",{value:i,text:i})).val(i),k("city").append($("<option>",{value:s,text:s})).val(s);var l=".js-streetNumber";1===t.length?(k("cep").val(k("cep").masked(o)),k("streetName").prop("disabled",!0).val(a)):(u&&k("streetName").prop("disabled",!1).val(""),l=".js-streetName");function c(){var e;null===(e=document.querySelector("".concat(p," ").concat(l)))||void 0===e||e.focus({preventScroll:!1})}P()?C("html, body","".concat(p,' label[for="Region"]'),!1,c,300):c()}else{var d=!killConfig.isMarketEnabled("redirectUserWithMissingInfo")||S();g()!==h.ANONYMOUS&&!d||N(!0,"codeOverlay",{},{code:"eCEPNotFound"})}})},saveCustomerBOLO:function(o){var e={countryCode:w,state:$(".js-region").val(),city:$(".js-city").val(),street:$(".js-streetName").val().toUpperCase()};jsDPZ.ajax.globalStoreSearchTypeAheadAddress(e).then(function(e){var t,r={FirstName:killConfig.isMarketEnabled("customerLegacyName")?$(".js-profileFirstName").val():"",LastName:$(".js-profileLastName").val(),Password:$(".js-confirmPassword").val(),Phone:$(".js-phone").val(),Extension:$(".js-extension").val(),Email:$(".js-email").val(),EmailOptIn:!1,AgreeToTermsOfUse:!0,Age13OrOlder:!0};if(r.Addresses=[{StreetName:$(".js-streetName").val(),StreetNumber:$(".js-streetNumber").val(),Type:$(".js-changeAddressTypeSelect").val(),UnitType:$(".js-changeAddressTypeSelect").val(),LocationName:$(".js-locationName").val(),UnitNumber:$(".js-unitNumber").val(),Neighborhood:f,AddressLine2:"",AddressType:$(".js-changeAddressTypeSelect").val(),PostalCode:e.Addresses[0].Cep,Region:$(".js-region").val(),Street:"".concat($(".js-streetName").val()),City:$(".js-city").val(),Name:$(".js-addressName").val(),DeliveryInstructions:$("#Delivery_Instructions").val()}],jsDPZ.app.customer.getCustomer().data.Session.BoloStore&&"Delivery"===$(".circ-icons [type='radio']:checked").val()){if($(".js-saveToProfile").is(":checked")||"loggedin"!==g())return t=$(".js-saveToProfile").is(":checked")?(jsDPZ.app.customer.getCustomer().data.Addresses=jsDPZ.app.customer.getCustomer().data.Addresses.concat(r.Addresses[0]),{data:$.extend(!0,{},jsDPZ.app.customer.getCustomer().getCustomerForPower(),t)}):{data:$.extend(!0,{},jsDPZ.app.customer.getCustomer().getCustomerForPower(),r)},jsDPZ.ajax.customerSave(t).then(function(e){return jsDPZ.app.customer.setCustomerFromPower(e),jsDPZ.app.customer.getCustomer().data.Session.BoloStore=!0,site.sessionTools.save()}).then(function(){T.boloRedirectToken(r)}).fail(function(){N(!0,"codeOverlay",{},{code:"eDuplicatedEmail"})});T.boloRedirectToken(o||r)}else{if("loggedin"!==g()||!jsDPZ.app.customer.getCustomer().data.Session.BoloStore||"Delivery"!==$(".circ-icons [type='radio']:checked").val())return r;T.boloRedirectToken(r)}})},boloRedirectToken:function(r){return jsDPZ.ajax.globalStoreSearch({data:r.Addresses[0]}).then(function(e){return(i=e.Stores[0]?e.Stores[0]:{}).IsDeliveryStore&&i.IsOnlineNow&&!1===i.EcomActive?jsDPZ.app.customer.getCustomer().data.Session.BoloStore=!0:i.IsDeliveryStore&&i.IsOnlineNow&&!0===i.EcomActive&&(jsDPZ.app.customer.getCustomer().data.Session.BoloStore=!1),site.sessionTools.save(),e}).then(function(e){var t;return!(!(!e.Stores||!e.Stores[0])&&e.Stores[0].IsOpen)&&jsDPZ.app.customer.getCustomer().data.Session.BoloStore?N(!0,"codeOverlay",{},{code:"eNoDeliveryStoreFound"}):jsDPZ.app.customer.getCustomer().data.Session.BoloStore?T.getCategoryProduct().then(function(e){t=e}).then(function(e){if("loggedin"!==g())return!1;jsDPZ.ajax.customerLoginPowerCallEncrypted({authorization:jsDPZ.util.oauth.getTokens().accessTokens,customerID:jsDPZ.app.customer.getCustomer().data.CustomerID,data:r.Addresses[0]}).then(function(e){jsDPZ.app.customer.getCustomer().data.Session.BoloStore&&(jsDPZ.app.customer.getCustomer().data.Session.BoloStore=!1,site.sessionTools.save().then(function(){$.post({url:"https://api.dominos.com.br/golo/redirectFromGolo",data:{StoreID:i.StoreID,Category:t||"",ServiceMethod:"Carryout"===$(".circ-icons [type='radio']:checked").val()?"Carryout":"Delivery"},headers:{Authorization:"Bearer ".concat(e)}}).fail(function(){N(!0,"codeOverlay",{},{code:"eAPIRedirectBOLO"}),site.sessionTools.save()}).then(function(e){window.location=e.url})}))})}):(jsDPZ.app.customer.getCustomer().data.Session.BoloStore=!1,site.sessionTools.save(),y.controller.mRouteAndExecute(A({url:"#!/locate/?type=Delivery",parameters:r.Addresses[0]||I}))),e})},deliveryBuilder:function(u){var e={cep:(u.Cep||k("cep").val()).replace("-",""),city:u.City||k("city").val(),countryCode:w,state:u.Region||k("region").val(),street:u.StreetName||k(".streetName").val().toUpperCase()};return $.Deferred(function(d){jsDPZ.ajax.globalStoreSearchTypeAheadAddress(e).then(function(e){var t=e.Addresses,r=void 0===t?[]:t,o=u.StreetName||u.StreetField1,s=r.find(function(e){return e.Street===o})||r[0]||{},a=s.Cep,n=s.City,i=s.Street,l=s.Neighborhood,c=s.State;I={OrganizationName:u.Location_Name,LocationName:u.Location_Name,StreetName:i||o,Name:u.Address_Name.trim(),StreetNumber:u.StreetNumber,StreetAddress1:"".concat(u.StreetNumber," ").concat(u.StreetName),Street:"".concat(u.StreetNumber," ").concat(u.StreetName),AddressLine2:u.Address_Line_2||"",City:n||u.City,Neighborhood:l||f||"neighborhood",UnitNumber:u.UnitNumber,UnitType:u.Address_Type_Select,Category:u.Category,Region:c||u.Region,PostalCode:a||u.Cep.replace("-",""),DeliveryInstructions:u.Delivery_Instructions,Type:u.Address_Type_Select,SaveToProfile:u.Save_Address,IsDefault:!1!==u.Is_Default,g:"1"},site.storage.save("dpz_customer_address",jsDPZ.dataConversion.JSONObjectToString(I)),jsDPZ.app.customer.getCustomer().data.Session.Address=I,site.sessionTools.save(),"Delivery"===u.Service_Type||_||L||u.Save_Address||"Delivery"===$(".circ-icons [type='radio']:checked").val()?d.resolve({OrganizationName:u.Location_Name,LocationName:u.Location_Name,StreetName:i||o,Name:u.Address_Name.trim(),StreetNumber:u.StreetNumber,Street:"".concat(u.StreetNumber," ").concat(u.StreetName),AddressLine2:u.Address_Line_2||"",City:n||u.City,Neighborhood:l||f||"neighborhood",UnitNumber:u.UnitNumber,UnitType:u.Address_Type_Select,Category:u.Category,Region:c||u.Region,PostalCode:a||u.Cep.replace("-",""),DeliveryInstructions:u.Delivery_Instructions,Type:u.Address_Type_Select,SaveToProfile:u.Save_Address,IsDefault:!1!==u.Is_Default}):d.resolve({City:u.City,Region:m.getRegionForCity(u.City)})})})},verifyAddress:function(e){var t=$.Deferred();return t.resolve(e.data),t}}),T});