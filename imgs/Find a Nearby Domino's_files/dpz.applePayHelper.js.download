function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a=[],l=!0,i=!1;try{for(n=n.call(e);!(l=(o=n.next()).done)&&(a.push(o.value),!t||a.length!==t);l=!0);}catch(e){i=!0,r=e}finally{try{l||null==n.return||n.return()}finally{if(i)throw r}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}define(["dpz.template","marketconfig/dpz.lang.checkout","marketconfig/dpz.lang.confirmation"],function(e,t,n){function l(e){var t=0<arguments.length&&void 0!==e?e:{},n=t.onSubmitResolve,o=t.onSubmitReject,r=t.link,a=t.placeOrderData;Object.assign(m,{onvalidatemerchant:function(e){(function(e){var t=e.link,n=e.appleUrl,o=e.placeOrderData;return jsDPZ.ajax.request({url:jsDPZ.util.htmlUnEncode(t.url),type:t.method,contentType:"application/json",data:JSON.stringify($.extend(!0,{},{orderRequestDto:o},{additionalRequestParams:{domain:window.location.hostname,validationUrl:n},orderRequestDto:{Order:{OrderMethod:"web",SourceOrganizationURI:jsDPZ.config.dataModel.ORDER_REQUEST.SourceOrganizationURI}}}))})})({link:r,appleUrl:e.validationURL,placeOrderData:a}).then(function(e){console.log(e,"onvalidatemerchant"),null!=e&&e.response?m.completeMerchantValidation(e.response):(jsDPZ.topic("validate.wallet.failure").publish({error:new Error("No response body from validate wallet call.")}),null==o||o({reason:"validateWalletResponseFailed"}))}).catch(function(e){jsDPZ.topic("validate.wallet.failure").publish({error:e})})},onpaymentmethodselected:function(e){console.log(e,"onpaymentmethodselected"),m.completePaymentMethodSelection({newTotal:f.total,newLineItem:[]})},onshippingcontactselected:function(e){console.log(e,"onshippingcontactselected"),m.completeShippingContactSelection({newTotal:f.total})},onshippingmethodselected:function(e){console.log(e,"onshippingmethodselected"),m.completeShippingMethodSelection({newTotal:f.total})},onpaymentauthorized:function(e){console.log(e,"onpaymentauthorized"),$.extend(i,e),m.completePayment(g.STATUS_SUCCESS),null==n||n()},oncancel:function(e){$(".js-placeOrder:disabled").prop("disabled",!1),console.log(e,"oncancel"),null==o||o({reason:"applePayCancelled"})}})}var o=e.isTranslationStringEmpty,r=e.translate,m=null,i={},a=o("checkout.apple_pay_total",t)?r("confirmation.total",null,n):r("checkout.apple_pay_total",null,t),f={currencyCode:null,countryCode:dpz.market.marketCode,merchantIdentifier:"",merchantCapabilities:[],supportedNetworks:[],shippingType:{Carryout:"storePickup",Delivery:"delivery"}[jsDPZ.app.order.getOrder().data.Details.ServiceMethod],total:{label:a,amount:null,type:"final"}},g=window.ApplePaySession,h=function(){for(var e=0;null!=g&&g.supportsVersion(e+1);)e++;return e}(),c=null==g?void 0:g.canMakePayments();return{applePayAvailable:function(e){var t=0<arguments.length&&void 0!==e?e:[];return c&&killConfig.isMarketEnabled("98b601a4-7503-4efc-add4-3e61fffa94b0")&&function(e){var t={amex:1,cartesBancaires:4,chinaUnionPay:1,discover:1,eftpos:4,electron:4,elo:5,interac:1,jcb:2,mada:5,maestro:4,masterCard:1,privateLabel:1,visa:1,vPay:4};return e.map(function(e){return t[e]}).every(function(e){return e<=h})}(t)},renderApplePayButton:function(e){function r(o){function e(e){var t="applepay"===e.currentTarget.dataset.gpmPaymentSubtype,n="radio"===e.currentTarget.type;(t||n)&&($(".js-placeOrder").toggleClass("is-hidden",t),o(t))}return $(".js-paymentType").on("click",e),function(){$(".js-paymentType").off("click",e)}}var t=0<arguments.length&&void 0!==e?e:{},n=t.overrideClickHandler,a=t.buttonType,o=t.currencyCode,l=t.configExtension,i=t.gpmFormPromise,c=t.getTotalAmount,p=l.merchantIdentifier,u=g.canMakePaymentsWithActiveCard(p),s=new Promise(function(n,e){require(["payment.components"],function(e){var t=e.ApplePayButton;n(t)},function(){jsDPZ.topic("apple.pay.button.component.error").publish({error:new Error("requirejs failed to retrieve Apple Pay Button component.")}),e()})}),d=document.querySelector(".js-applePayButtonContainer"),y=n||function(){$.extend(!0,f,l,{currencyCode:o,total:{amount:(null==c?void 0:c())||jsDPZ.app.order.getOrder().data.Details.Amounts.Customer.toString()}}),console.log("call applepaysession constructor"),console.log(h,"apple pay version being used"),console.log(f,"config object for constructor"),m=new g(h,f),$(".js-placeOrder").click()};Promise.all([u,s,i]).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];n||g.openPaymentSetup&&p&&(y=function(){g.openPaymentSetup(p).then(function(e){}).catch(function(e){})}),preact.render(preact.h(o,{buttonType:a,dpzMarket:dpz.market,showAndHideOnClick:r,clickHandler:y}),d)})},beginPaymentFlow:function(e){var t=0<arguments.length&&void 0!==e?e:{},n=t.onSubmitResolve,o=t.onSubmitReject,r=t.link,a=t.placeOrderData;l({onSubmitResolve:n,onSubmitReject:o,link:r,placeOrderData:a}),console.log("begin()"),m.begin()},getAuthorizedResponse:function(){return i},getApplePayConfig:function(){return f},setApplePayConfig:function(e){return f=e},getApplePaySession:function(){return m},setApplePaySession:function(e){return m=e},getApplePayToken:function(){var e=i.payment,t=(e=void 0===e?{}:e).token;return void 0===t?{}:t}}});