function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(o=n.next()).done)&&(a.push(o.value),!t||a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}define(["simplr","dpz.config","site.funcs","pizzabuildermodules/dpz.pizzaBuilderConstants"],function(y,e,t,n){var p=e.getMarketProperty,f=t.func.isHandheld,g=n.buildSteps,b={};return $.extend(b,{getIsHalfAndHalf:function(e){var t,n=0<arguments.length&&void 0!==e?e:{},o=n.productCode,r=n.code;return"S_HNH"===o||(null==r?void 0:null===(t=r.includes)||void 0===t?void 0:t.call(r,"/"))},initializeSteps:function(e,t){var n,o,r,a=p("pizzaBuilder").views,i=a.builderSteps,c=a.halfAndHalfSteps,l=p("upsells").pizzaBuilderUpsells,u=b.getIsHalfAndHalf(e),s=$.extend([],u?c:i),d=null===(n=l.sides)||void 0===n?void 0:null===(o=n.products)||void 0===o?void 0:null===(r=o.some)||void 0===r?void 0:r.call(o,function(e){return jsDPZ.app.catalog.getCatalog().getProduct(e)});(site.func.isHandheld()||!e.isNew&&"pizzaBuilderSides"!==e.defaultTab||!d||jsDPZ.app.customer.getCustomer().data.Session.hidePizzaBuilderSides)&&(s=s.filter(function(e){return e!==g.SIDES})),f()&&d||(s=s.filter(function(e){return e!==g.DIP_CUPS})),t.currentStep=0,u&&e.couponCode&&1===e.couponAllowableVariants.length&&s.shift(),t.stepsArray=s.map(function(e){return e.slice(e.lastIndexOf("/")+1)})},prepareToppingTokens:function(i){var e,t,n,o,c=i.commonBuilder,r=i.currentVariant,a=i.viewData,l=c.catalog,u={},s=["ThirdGroup","NonMeat","Meat"].concat(_toConsumableArray(b.getIsHalfAndHalf(a)?["Cheese","Sauce"]:[])),d=l.getProduct(a.productCode).data,p=l.getVariant(r.Code).data,f=null===(e=p.Tags)||void 0===e?void 0:null===(t=e.HideOption)||void 0===t?void 0:null===(n=t.split)||void 0===n?void 0:n.call(t,":"),g=l.getAvailableProductToppingsData(d.Code),h=a.mobileSinglePagePizzaBuilder;g.forEach(function(t){var e=c.functions.setWeightList(t),n=c.functions.setPartsAvailability(t,i),o=function(e){var t,n,o=e.Code;return!(null!=p&&p.Tags.BlockCustom)||(null==p?void 0:null===(t=p.Tags)||void 0===t?void 0:null===(n=t.ToppingException)||void 0===n?void 0:n.split("|").includes(o))}(t),r=_objectSpread(_objectSpread({},t),{},{isCustomizable:o,productCode:d.Code,toppingCode:t.Code,toppingName:t.Name,toppingShortName:y.util.mTruncateString({string:t.Name,size:18,postfix:"...",smart:!1}),toppingParts:n,toppingSplit:t.Tags.WholeOnly?"NOSPLIT":"SPLIT",toppingWeights:"<select aria-label=".concat(t.Name,' class="weight" name="Weight|').concat(t.Code,'" ').concat(i.commonBuilder.functions.setOptionDisabled(!o),">").concat(site.func.buildOptionList({listValues:e,defaultValue:"1"}),"</select>"),toppingType:""}),a=Object.keys(t.Tags);s.forEach(function(e){-1!==$.inArray(e,a)&&("Sauce"!==e||h?(e in u||(u[e]={translation:"choose_".concat(e,"s"),tab:"tab_text_".concat(e),column:{component:"builderPizzaToppings",tokens:[]}}),t.Tags.NewImproved&&(r.toppingName+="*"),r.toppingType=e,function(e){return!(p.Tags&&!p.Tags.HideOption)&&f.includes(e.Code)}(t)||u[e].column.tokens.push(r)):e in u||(u[e]={translation:"choose_".concat(e,"s"),tab:"tab_text_".concat(e),column:{component:"builderPizzaToppings",tokens:{selector:"js-sauces"}}}))})});var m=[];return Object.keys(u).forEach(function(n){Object.keys(u[n]).forEach(function(t){m.push(dpz.template.assembleLayout(u[n][t]).then(function(e){u[n][t].markup=e}))})}),(o=$).when.apply(o,m).then(function(){return u})}}),y.view.mAddViews({pizzaBuilderHalfAndHalf:{html:function(e){var t=$.extend(!0,{},e.commonBuilder.catalog),n=e.viewData,o=$.extend(!0,[],e.commonBuilder.catalog.getCategoryData("Food","Pizza").Categories),r=(n.couponCode&&n.couponAllowableProducts.length?t.getCategoryData("Food","Pizza").Categories.map(function(e){return e.Products=e.Products.filter(function(e){return n.couponAllowableProducts.includes(e)&&!p("pizzaBuilder").halfAndHalfOptions.productExclusions.includes(e)}),e}):o.map(function(e){return _objectSpread(_objectSpread({},e),{},{Products:e.Products.filter(function(e){var t=jsDPZ.app.catalog.getCatalog().getProduct(e).data,n=t.Code,o=t.Tags;return!(p("pizzaBuilder").halfAndHalfOptions.productExclusions.includes(n)||o.CouponOnly||o.hasOwnProperty("Hidden"))})})})).filter(function(e){return e.Products.length}).map(function(e){return{name:jsDPZ.util.htmlUnEncode(e.Name),products:e.Products.map(function(e){return{code:e,name:t.getProduct(e).data.Name}})}}),a=p("pizzaBuilder").singlePageBuilder;return dpz.template.assembleLayout({component:"pizzaBuilderHalfAndHalf",tokens:{categoryCount:r.length,mobileSinglePagePizzaBuilder:f()&&a.handheld,pizzaCategoriesTokens:r}})},callback:function(r,e){function c(e,i){function c(e){return l.includes(e)&&"X"!==e}var l=Object.keys(m.data.Toppings.Pizza).filter(function(e){return m.data.Toppings.Pizza[e].Tags.Sauce}),t=m.getVariant(e).data.Tags.DefaultToppings.split(","),u="Whole"!==i;t.forEach(function(e){var t=_slicedToArray(e.split("="),2),n=t[0],o=t[1],r=Object.keys(h.Toppings).filter(c),a=l.includes(n);u&&a&&"X"!==n&&y.removeTopping("X","Left"),"X"===n&&(r.length||"X"!==n)||(a&&u&&y.setTopping(n,p["Left"===i?"Right":"Left"],o),y.setTopping(n,p[i],o))})}function l(){$("input[class='selectSpecialty']:unchecked").each(function(e,t){function n(e){return m.getProduct(e).data.Variants.map(function(e){var t=m.getVariant(e).data;return t.SizeCode+t.FlavorCode})}var o=$(t),r=o.attr("name"),a=n(m.getVariant(h.Code).data.ProductCode),i=n(r),c=new Set(a),l=new Set(i),u=Array.from(new Set(_toConsumableArray(c).filter(function(e){return l.has(e)})));o.prop("disabled",!u.length)})}function o(n,e){var t,o=h.Code.split("/"),r=m.getVariant(o[0]).data,a=m.getProduct(r.ProductCode).data.Variants.reduce(function(e,o){var t=m.getProduct(n).data.Variants.find(function(e){var t=m.getVariant(o).data,n=m.getVariant(e).data;return t.FlavorCode===n.FlavorCode&&t.SizeCode===n.SizeCode});return t&&(e[o]=t),e},{});if(a[o[0]])t=a[o[0]];else{var i=Object.keys(a)[0];t=a[i],o=o.map(function(e){return e===o[0]?i:e})}!function(t){Object.keys(h.Toppings).forEach(function(e){y.setTopping(e,p[t],"0"),delete f.toppings[e],delete h.Toppings[e]})}(e),setTimeout(function(){c(t,e)},0),"Left"===e?o.unshift(t):"Right"===e?o.push(t):o=[t],3===o.length&&o.splice(1,1),h.Code=o.join("/"),l(),g&&$(document).trigger("render.cheeseSauceToppings-steps")}function a(e,t,n){$("".concat(e," div"),r).attr("class",function(e,t){return t.replace(/(\S+)Active/,"$1Inactive")}),$("".concat(e," .").concat(t,"Inactive"),r).attr("class",function(e,t){return t.replace(/(\S+)Inactive/,"$1Active")}),$(e,r).show(),n||o(e.split("--")[1],t)}var i,u,s,d,p={Left:"1/2",Whole:"1/1",Right:"2/2"},f=e.viewData,g=f.mobileSinglePagePizzaBuilder,h=e.currentVariant,m=e.commonBuilder.catalog,y=e.commonBuilder.functions,t=h.Code.split("/").map(function(e){return m.getVariant(e).data.ProductCode});$("input.selectSpecialty, .js-makeWhole",r).on("click",function(e){var t=$(this),n=t.hasClass("js-makeWhole")&&t.hasClass("WholeInactive"),o=t.is("input");i=$("input.selectSpecialty:checked",r),u=$(this).attr("name")||$(this).parent().data("name"),s=[],d=i.length,i.each(function(e,t){var n=$(t,r).attr("name");n!==u&&s.push(n)}),3===d||n?(s.forEach(function(e){$("input[name=".concat(e,"]"),r).prop("checked",!1),$(".js-portion--".concat(e),r).hide()}),a(".js-portion--".concat(u),"Whole")):o&&(2===d?(a(".js-portion--".concat(s[0]||u),"Left"),a(".js-portion--".concat(u),"Right")):1===d?($(".js-portion--".concat(u),r).hide(),a(".js-portion--".concat(s[0]||u),"Whole")):d||e.preventDefault())}),t.forEach(function(e){if($(".js-specialtyPizzaSelection--".concat(e," input"),r).prop("checked",!0),$(".js-portion--".concat(e),r).show(),$("[class*='Active']",r).length){var t=$("[class*='Active']").parent().data("name"),n=".js-portion--".concat(t);a(n,"Left",!0),a(".js-portion--".concat(e),"Right",!0)}else a(".js-portion--".concat(e),"Whole",!0);l()}),g&&$(document).trigger("render.cheeseSauceToppings-steps")}}}),b});