function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=new Array(r);t<r;t++)o[t]=e[t];return o}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}define("dpz.recentOrder",["dpz.config","dpz.home","marketconfig/dpz.lang.payment","marketconfig/dpz.lang.home"],function(e,r,m,h){var s=e.getMarketProperty,i={name:"",description:"",category:"",code:"",qty:""},f={AdyenV2:"AdyenV2",AlamarWallet:"AlamarWallet",AlamarWalletPromotional:"AlamarWalletPromotional",Ayden:"Ayden",Cash:"Cash",CreditCard:"CreditCard",DoorCredit:"DoorCredit",DoorDebit:"DoorDebit",Fac:"Fac",Fac2:"Fac2",Fnb:"Fnb",GiftCard:"GiftCard",GrabPay:"GrabPay",Interswitch:"Interswitch",InterswitchKE:"InterswitchKE",IPay:"IPay",IZIPay:"IZIPay",Kiple:"Kiple",Mastercard:"Mastercard",MayBank:"MayBank",Maybank2:"Maybank2",Moyasar:"Moyasar",Nexi:"Nexi",Openpay:"Openpay",PayPal:"PayPal",PayPalV3:"PayPalV3",PlaceToPay:"PlaceToPay",Plexo:"Plexo",PostFinance:"PostFinance",Reduniq:"Reduniq",RewardPoints:"RewardPoints",Sadad:"Sadad",Transbank:"Transbank",ValesCDMX:"ValesCDMX",VisaCybersource:"VisaCybersource",Wow:"Wow"};return{setOrderProducts:function(e,r){return e.map(function(n){var e=$.extend({},i);return e.name=n.name,e.category=n.CategoryCode,e.code=n.Code,e.qty=n.Qty,r&&(jsDPZ.util.htmlUnEncode(n.name),e.prodObj=JSON.stringify(n),e.placeOrderTime=n.PlaceOrderTime,e.groupedByCategory=!0),e.description=n.descriptions.reduce(function(e,r){var t=r.portionCode,o=r.value,a=t.replace("&#x2F;","/");return/\d\/\d/.test(a)&&("1/1"!==a||"Pizza"===n.CategoryCode&&1<n.descriptions.length)&&(e="".concat(e," <b class='bold'>").concat(site.data.uiConfig.AVAILABLE_LOCATIONS_HASH[a],":</b> ")),"".concat(e," ").concat(o," <br />")},""),e})},setItemizedRecentOrderProducts:function(r,t){return Object.keys(r.products).map(function(o){var a=r.products,e=$.extend({},i);return e.name=a[o].name,e.category=a[o].CategoryCode,e.code=a[o].Code,e.qty=a[o].Qty,e.productKey=o,t&&(jsDPZ.util.htmlUnEncode(a[o].name),e.prodObj=JSON.stringify(a[o]),e.placeOrderTime=a[o].PlaceOrderTime,e.groupedByCategory=!0),e.description=a[o].descriptions.reduce(function(e,r){var t=r.portionCode.replace("&#x2F;","/");return/\d\/\d/.test(t)&&("1/1"!==t||"Pizza"===a[o].CategoryCode&&1<a[o].descriptions.length)&&(e="".concat(e," <b class='bold'>").concat(site.data.uiConfig.AVAILABLE_LOCATIONS_HASH[t],":</b> ")),"".concat(e," ").concat(r.value," <br />")},""),e}).filter(function(e){return killConfig.isMarketEnabled("halfAndHalfBuilder")||!jsDPZ.util.htmlUnEncode(e.code).includes("/")})},setOrderPayment:function(l){function o(e){var r,t,o,a=dpz.template,n=a.translate,i=a.transformAndTranslate,d=e.Type,c=e.CardType,s=(_defineProperty(r={},f.AlamarWallet,"payment.alamar_wallet"),_defineProperty(r,f.AlamarWalletPromotional,"payment.alamar_wallet_promotional"),_defineProperty(r,f.Cash,"payment.pay_at_store"),_defineProperty(r,f.Fac,"payment.creditcard"),_defineProperty(r,f.Fac2,"payment.creditcard"),_defineProperty(r,f.Fnb,"payment.creditcard"),_defineProperty(r,f.GrabPay,d.toLowerCase()),_defineProperty(r,f.Interswitch,"payment.creditcard"),_defineProperty(r,f.InterswitchKE,"payment.interswitch"),_defineProperty(r,f.Mastercard,"payment.creditcard"),_defineProperty(r,f.Maybank2,"payment.maybank_2"),_defineProperty(r,f.Moyasar,"payment.creditcard"),_defineProperty(r,f.Nexi,"payment.creditcard"),_defineProperty(r,f.Openpay,"payment.creditcard"),_defineProperty(r,f.PlaceToPay,"payment.creditcard"),_defineProperty(r,f.RewardPoints,"payment.rewardpoints"),_defineProperty(r,f.Sadad,"payment.sadadPayment"),_defineProperty(r,f.Transbank,"payment.creditcard"),_defineProperty(r,f.ValesCDMX,"payment.valescdmx"),_defineProperty(r,f.VisaCybersource,"payment.creditcard"),_defineProperty(r,f.Wow,"payment.wow_plus"),r),y=(_defineProperty(t={},f.AdyenV2,c||d.toLowerCase()),_defineProperty(t,f.MayBank,c||d.toLowerCase()),_defineProperty(t,f.PostFinance,c||d.toLowerCase()),_defineProperty(t,f.Reduniq,c||"credit_debit"),_defineProperty(t,f.Cash,d),_defineProperty(t,f.DoorCredit,d),_defineProperty(t,f.DoorDebit,d),_defineProperty(t,f.IPay,d),_defineProperty(t,f.IZIPay,d),_defineProperty(t,f.Kiple,d),_defineProperty(t,f.RewardPoints,d),_defineProperty(t,f.PayPal,d),_defineProperty(t,f.PayPalV3,d),_defineProperty(t,f.Plexo,c||d.toLowerCase()),t);switch(d){case f.RewardPoints:if(killConfig.isMarketEnabled("gpmQitaf"))return n(s[d],null,m);case f.Cash:return"Carryout"===l.order.ServiceMethod||"DineIn"===l.order.ServiceMethod?n(s[d],null,m):i("payment",y[d],null,m);case f.Adyen:case f.CreditCard:return null!==(o=l.cards)&&void 0!==o&&o.length?l.cards[0].nickName:c||d}if(s[d]){if("payment.creditcard"!==s[d])return n(s[d],null,m);var u=function(e){var r=e.CardID;return jsDPZ.app.customer.getCustomer().data.CreditCards.find(function(e){return e.id===r})}(e);return u?u.nickName:n(s[d],null,m)}return y[d]?i("payment",y[d],null,m):p}function a(e){var r=t.indexOf(e);return-1===r?Number.MAX_VALUE:r}var p=dpz.template.translateError("iDefaultPaymentType"),e=s("profile").recentOrders,r=(e=void 0===e?{}:e).paymentTypePriorities,t=void 0===r?[]:r,n=e.allowMultiplePayments,i=void 0!==n&&n,d=e.separator,c=void 0===d?", ":d;return l.order.Payments.filter(function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).Type;return"WowAccrual"!==(void 0===e?"":e)}).sort(function(e,r){var t=e.Type,o=r.Type;return a(t)-a(o)}).reduce(function(e,r){var t=o(r);return e.length&&!i?e:Array.from(new Set([].concat(_toConsumableArray(i?e:[]),[t])))},[]).join(c)},getRecentItemsTokens:function(e,r,t){var o,a,n,i,d,c,s=null===(o=jsDPZ.app.catalog.getCatalog().data.Categorization.Food.Categories)||void 0===o?void 0:o.reduce(function(r,e){return e.Categories.length&&e.Categories.forEach(function(e){return r.push(e)}),r.push(e),r},[]),y=e.easyOrder||(null===(a=e.customerOrders)||void 0===a?void 0:a[0])||{},u=Object.keys(y).length?t(y):null,l=(null===(n=y.order)||void 0===n?void 0:n.ServiceMethod)||"Carryout",p={groupedByCategories:!0,paymentMethod:u,paymentType:null!==(i=y.order)&&void 0!==i&&null!==(d=i.Payments)&&void 0!==d&&d[0]?y.order.Payments[0].Type:"",previousItemsTitle:killConfig.isMarketEnabled("profiledHomepageCollapsedSections")&&site.isHomepage?"previous_items":"your_previously_ordered_items",serviceMethod:l},m=e.products?r(e,!0):[],f=dpz.config.getMarketProperty("categories").recentOrderItemsCategory;if(site.func.isHandheld()){var P;c=null===(P=e.productsByCategory)||void 0===P?void 0:P.sort(function(e,r){return f.indexOf(e.category)-f.indexOf(r.category)}).map(function(e){var r=e.productKeys.reduce(function(e,r){var t=m.find(function(e){return e.productKey===jsDPZ.util.htmlUnEncode(r)});return t&&e.push(t),e},[]),t=null==s?void 0:s.find(function(e){return r[0].category===e.Code}).Name;return{categoryCode:t,categoryName:e.category,products:{component:"previousItemsProductView",tokens:r.map(function(e){return _objectSpread(_objectSpread({},e),{},{category:t,categoryFromMenu:e.category})})},showCategories:!0}})}else{var g,v=(null===(g=e.productsByFrequencyRecency)||void 0===g?void 0:g.reduce(function(e,r){var t=m.find(function(e){return e.productKey===jsDPZ.util.htmlUnEncode(r.productKey)});return t&&e.push(_objectSpread(_objectSpread({},t),{},{groupedByCategory:!1})),e},[]))||[];c={categoryCode:"All",categoryName:dpz.template.translate("home.items",null,h),products:{component:"previousItemsProductView",tokens:v.map(function(e){return _objectSpread(_objectSpread({},e),{},{categoryFromMenu:null==e?void 0:e.category})})},showCategories:!1}}p.categories={component:"previousItemsCategoryView",tokens:c};var C,_,b="Delivery"===l;(p.isAddressFormatted=!0,b)?(p.customerAddress=site.func.getOrderHistoryFormattedCustomerAddress(null===(C=y.order)||void 0===C?void 0:C.Address),p.customerAddress.Name=y.addressNickName||"",p.customerAddress.LocationName=p.customerAddress.OrganizationName):(p.customerAddress=site.func.getOrderHistoryFormattedCustomerAddress(null===(_=y.store)||void 0===_?void 0:_.address),p.customerAddress.Name=dpz.template.translateError("iDeliveryLocationLabel"));return 0<jsDPZ.app.order.getOrder().data.Details.Variants.length&&(p.cartNotEmpty=!0),p},removeOrderUnusedFields:function(e){e.easyOrder&&(delete e.easyOrder,delete e.easyOrderNickName),e.order.Coupons.remove(0,e.order.Coupons.length),e.order.Products.remove(0,e.order.Products.length)},fireAnalytics:function(e){var r,t;return 0<jsDPZ.app.order.getOrder().data.Details.Variants.length&&dpz.utag.fire.link(null,{event_name:"Cart not empty message shown",event_action:"error",event_category:"error"}),t=e?$.isArray(e.categories.tokens)?(dpz.utag.fire.link(null,{event_name:"".concat(e.categories.tokens.length," Categories shown"),event_action:"update",event_category:"Categories update"}),e.categories.tokens.reduce(function(e,r){return e+r.products.tokens.length},0)):null===(r=e.categories.tokens)||void 0===r?void 0:r.products.tokens.length:"No",jsDPZ.app.customer.getCustomer().data.Session.recentItemProductCount=t,site.sessionTools.save(),e}}});