define("dpz.geolocation",function(){Number.prototype.toRad=function(){return this*Math.PI/180};var m={cacheLocation:function(t){var o=$.extend({},t.coords),e=$.extend({},t,{coords:o});return jsDPZ.app.customer.getCustomer().data.Session.cachedPosition=e,site.sessionTools.save()},getUserLocation:function(t){var o=0<arguments.length&&void 0!==t?t:{},n=o.lowAccuracy,e=o.highAccuracyTimeout,i=void 0===e?3e3:e,a=o.lowAccuracyTimeout,c=void 0===a?7e3:a,r=o.maximumAge,u=void 0===r?0:r,s=$.Deferred(function(o){function t(t){m.cacheLocation(t).then(function(){o.resolve(t)})}function e(){return navigator.geolocation.getCurrentPosition(t,o.reject,{enableHighAccuracy:!1,timeout:c,maximumAge:u})}n?e():navigator.geolocation.getCurrentPosition(t,e,{enableHighAccuracy:!0,timeout:i,maximumAge:u})});return{cached:jsDPZ.app.customer.getCustomer().data.Session.cachedPosition?jsDPZ.app.customer.getCustomer().data.Session.cachedPosition:s,current:s}},handleLocationChange:function(t,o){t(o)},watchUserLocation:function(t,o){var e=0<arguments.length&&void 0!==t?t:{},i=e.lowAccuracy,n=e.highAccuracyTimeout,a=void 0===n?3e3:n,c=e.lowAccuracyTimeout,r=void 0===c?7e3:c,u=e.maximumAge,s=void 0===u?0:u,g=1<arguments.length&&void 0!==o?o:function(){},d=$.Deferred(function(o){function e(t){m.handleLocationChange(g,t),m.cacheLocation(t).then(function(){o.resolve(t)})}function t(t){e(t)}function n(){return navigator.geolocation.watchPosition(e,o.reject,{enableHighAccuracy:!1,timeout:r,maximumAge:s})}i?n():navigator.geolocation.watchPosition(t,n,{enableHighAccuracy:!0,timeout:a,maximumAge:s})});return{cached:jsDPZ.app.customer.getCustomer().data.Session.cachedPosition?jsDPZ.app.customer.getCustomer().data.Session.cachedPosition:d,current:d}},getPermission:function(){return navigator.permissions?navigator.permissions.query({name:"geolocation"}):new Promise(function(t){navigator.geolocation.getCurrentPosition(function(){t({state:"granted"})},function(){t({state:"denied"})})})},calculateDistance:function(t,o,e){var n=2<arguments.length&&void 0!==e?e:"miles",i=t.latitude||t.lat||t.Latitude||0,a=t.longitude||t.lng||t.Longitude||0,c=o.latitude||o.lat||o.Latitude||0,r=o.longitude||o.lng||o.Longitude||0,u=(c-i).toRad(),s=(r-a).toRad(),g=Math.sin(u/2)*Math.sin(u/2)+Math.cos(i.toRad())*Math.cos(c.toRad())*Math.sin(s/2)*Math.sin(s/2),d=6371*(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)));return"miles"===n?.621371*d:d}};return m});