function ownKeys(r,e){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),n.push.apply(n,t)}return n}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(r,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))})}return r}function _defineProperty(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,r):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}define("dpz.customerWallet",["dpz.customer","dpz.config","dpz.template","dpz.profile","site.funcs","simplr","marketconfig/dpz.lang.coupons","marketconfig/dpz.lang.customer","marketconfig/dpz.lang.general"],function(e,r,n,t,o,a,i,u,l){var s,c,d=e.getStatus,p=e.isProfiled,f=e.userStatus,y=f.LOGGED_IN,g=f.REMEMBERED,m=r.getMarketProperty,b=n.getTranslateContextValue,P=t.successCommands.ADD_COUPON,C=o.func,h=C.buildURL,O=C.getCurrentBreakpoint,j={isEnabled:killConfig.isMarketEnabled("gnolo.isCustomerWalletEnabled"),getPersonalCoupons:function(e){var r=(0<arguments.length&&void 0!==e?e:{filterOrderCoupons:!1}).filterOrderCoupons,n=void 0!==r&&r;return p()?$.when(s||jsDPZ.ajax.getPersonalCoupons()).then(function(e){var t=$.extend(!0,[],jsDPZ.app.order.getOrder().data.Details.Coupons);return s=e,n?e.reduce(function(e,r){var n=t.findIndex(function(e){return e.Code===r.data.Code});return 0<=n?(t.splice(n,1),e):[].concat(_toConsumableArray(e),[r])},[]):e}):$.Deferred(function(e){return(0,e.reject)("This feature is not enabled or user is not signed in")})},renderProfileWalletInColumn:function(){p()&&site.data.inOrderFunnel&&jsDPZ.app.order.getOrder().data.Details.StoreID&&!site.isPaymentPage&&!site.isConfirmationPage&&j.getPersonalCoupons({filterOrderCoupons:!0}).then(function(o){require(["order.components"],function(e){var r=e.OrderProfileWallet,n=e.TranslateContext,t=document.querySelector(".js-orderProfileWallet".concat("handheld"===O()?"Handheld":""));t&&preact.render(preact.h(n.Provider,{value:b(_objectSpread(_objectSpread(_objectSpread({},i),u),l))},preact.h(r,{coupons:o,addCoupon:function(e){var r=h({url:"#!/order/coupons/new",parameters:{code:e,qty:1,eCoupon:!0}}),n=d();n===y?a.controller.mRouteAndExecute(r):n===g&&site.func.showLoginPopup({successCommand:P,couponCode:e,eCoupon:!0})},getMarketProperty:m,jsDPZ:jsDPZ})),t)})})},updateCouponNumber:function(){j.getPersonalCoupons({filterOrderCoupons:!0}).then(function(e){c!==e.length&&(site.func.updateMinorNavigation(),j.renderProfileWalletInColumn(),c=e.length)})},unrenderProfileWalletInColumn:function(){if(p()&&site.data.inOrderFunnel&&!site.isPaymentPage&&!site.isConfirmationPage){[".js-orderProfileWallet",".js-orderProfileWalletHandheld"].map(document.querySelector).filter(Boolean).forEach(function(e){return preact.render(null,e)})}},cleanWallet:function(){c=null,j.unrenderProfileWalletInColumn()},orderHasCoupons:function(){return $.when(j.getPersonalCoupons(),j.getPersonalCoupons({filterOrderCoupons:!0})).then(function(){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).length!==e.length})},init:function(){$(document).on(["/order/validate/","/order/price/","/order/variant/new/","/order/variant/edit/","/order/variant/delete/"].join(" "),j.updateCouponNumber),$(document).on("customerLogin.success",j.renderProfileWalletInColumn),$(document).on("customerLogout",j.cleanWallet)}};return j});