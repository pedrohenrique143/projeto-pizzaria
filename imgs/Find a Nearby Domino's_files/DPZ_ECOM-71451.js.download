function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}define(["atLaunchDarkly","dpz.orderHistory","dpz.customer","dpz.mixAndMatch"],function(e,r,t,o){function n(e){var r=e.experience;return d[r]}function c(e){var t=e.productCodes,o=e.productVariations;return i().then(function(e){var r=[];return e.customerOrders.forEach(function(e){e.order.Products.forEach(function(e){"Pizza"!==e.CategoryCode&&t.includes(e.ProductCode)&&r.push(e.ProductCode)})}),(r=function(e){var t={};return e.forEach(function(e){t[e]=(t[e]||0)+1}),Object.keys(t).sort(function(e,r){return t[r]-t[e]})}(r)).length<3?[]:r.slice(0,4).map(function(e){return{Code:e,ProductType:p,Variants:o[e]}})})}var u=e.getOffer,i=r.getOrderHistory,a=t.isProfiled,s=o.getIsAnyMixAndMatch,d={cwrib:"b",cwric:"c"},p="Ecom71451PreviousItems";return{NEW_TEST_CATEGORY:p,getAvailableMMPreviousProducts:function(r,e){return r&&a()&&s(e)?function(e){return jsDPZ.ajax.coupon({CouponCode:e,StoreID:jsDPZ.app.customer.getCustomer().data.Session.StoreID}).then(function(e){var t=jsDPZ.app.catalog.getCatalog(),o={productCodes:[],productVariations:[]};return e.ProductGroups.forEach(function(e){e.ProductCodes.forEach(function(e){var r=t.getVariant(e).data.ProductCode;Array.isArray(o.productVariations[r])||(o.productVariations[r]=[]),o.productVariations[r].push(e),o.productCodes.push(r)})}),o})}(e).then(c).then(function(e){return _objectSpread(_objectSpread({},r),{},{previousProducts:e})}):Promise.resolve(null)},getFormattedExperience:n,getIsCollapsed:function(e){var r=e.test,t=e.category,o=n(r);return!(o&&("Pizza"===t||t===p&&"b"===o))},getOffer:u,mboxName:"DPZ_ECOM-71451",validExperiences:Object.keys(d)}});